<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Portal - Aliaga National High School</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="darkmode.css">
    <link rel="stylesheet" href="responsive.css">
    <script src="darkmode.js"></script>
    <script src="api.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            background-color: #f0f2f5;
            color: #333;
            line-height: 1.6;
            display: flex;
            min-height: 100vh;
        }
        .sidebar {
            width: 250px;
            background-color: #176a3a; /* Dark green */
            color: #fff;
            padding: 20px;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
        }
        .sidebar h2 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 1.8rem;
            color: #ffd600; /* Yellow */
        }
        .sidebar ul {
            list-style: none;
            padding: 0;
            flex-grow: 1;
        }
        .sidebar ul li {
            margin-bottom: 10px;
        }
        .sidebar ul li a {
            display: block;
            color: #fff;
            text-decoration: none;
            padding: 12px 15px;
            border-radius: 5px;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .sidebar ul li a:hover, .sidebar ul li a.active {
            background-color: #218c4a; /* Slightly lighter green */
            color: #ffd600;
        }
        .teacher-profile {
            background-color: #e8f5e9; /* Light green */
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 20px;
        }
        .teacher-profile h3 {
            margin-top: 0;
            color: #176a3a;
            font-size: 1.5rem;
        }
        .teacher-profile p {
            margin: 5px 0;
            color: #555;
        }
        .teacher-profile .status {
            font-weight: bold;
            color: #218c4a;
        }
        .teacher-profile .status.inactive {
            color: #d32f2f;
        }
        .main-content {
            flex-grow: 1;
            padding: 30px;
            background-color: #fff;
            border-radius: 10px;
            margin: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        .section-title {
            color: #176a3a;
            font-size: 2.2rem;
            margin-bottom: 25px;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
            font-weight: 600;
        }
        .card-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .card {
            background-color: #e8f5e9; /* Light green */
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            text-align: center;
        }
        .card h3 {
            margin-top: 0;
            color: #176a3a;
            font-size: 1.5rem;
        }
        .card p {
            font-size: 2.5rem;
            font-weight: bold;
            color: #218c4a;
            margin: 10px 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #176a3a;
            color: #fff;
            font-weight: bold;
        }
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        .btn-primary {
            padding: 10px 20px;
            background-color: #176a3a;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s ease;
        }
        .btn-primary:hover {
            background-color: #218c4a;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        .form-group input[type="text"],
        .form-group input[type="email"],
        .form-group input[type="tel"],
        .form-group input[type="number"],
        .form-group input[type="date"],
        .form-group select,
        .form-group textarea {
            width: calc(100% - 22px);
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1rem;
            box-sizing: border-box;
        }
        .message-item, .announcement-item, .resource-item, .event-item {
            background-color: #f9f9f9;
            border: 1px solid #eee;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
        }
        .message-item strong {
            color: #176a3a;
        }
        .message-item small {
            display: block;
            color: #777;
            margin-top: 5px;
        }
        .announcement-item {
            background-color: #fff3e0; /* Light orange */
            border: 1px solid #ffcc80;
        }
        .announcement-item h4 {
            margin-top: 0;
            color: #e65100; /* Dark orange */
            font-size: 1.1rem;
        }
        .resource-item {
            background-color: #e3f2fd; /* Light blue */
            border: 1px solid #90caf9;
        }
        .resource-item h4 {
            margin-top: 0;
            color: #1976d2; /* Dark blue */
            font-size: 1.1rem;
        }
        .resource-item a {
            color: #1976d2;
            text-decoration: none;
            font-weight: bold;
        }
        .resource-item a:hover {
            text-decoration: underline;
        }
        .assignment-item {
            background-color: #f0f9eb; /* Very light green */
            border: 1px solid #d4edda;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .assignment-item.completed {
            background-color: #e6ffe6;
            opacity: 0.7;
        }
        .assignment-item h4 {
            margin: 0;
            color: #176a3a;
        }
        .assignment-item p {
            margin: 5px 0 0;
            font-size: 0.9rem;
            color: #555;
        }
        .assignment-item .actions button {
            background-color: #ffd600;
            color: #176a3a;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .assignment-item .actions button:hover {
            background-color: #ffe066;
        }
        .document-list {
            list-style: none;
            padding: 0;
        }
        .document-list li {
            margin-bottom: 8px;
            padding: 5px 0;
            border-bottom: 1px dotted #eee;
        }
        .document-list li a {
            color: #176a3a;
            text-decoration: none;
            font-weight: bold;
        }
        .document-list li a:hover {
            text-decoration: underline;
        }
        .high-contrast {
            /* Styles for high contrast mode */
            background-color: #000 !important;
            color: #fff !important;
        }
        .high-contrast .sidebar, .high-contrast .main-content, .high-contrast .card,
        .high-contrast table, .high-contrast th, .high-contrast td,
        .high-contrast .message-item, .high-contrast .announcement-item, .high-contrast .resource-item,
        .high-contrast .assignment-item, .high-contrast .form-group input,
        .high-contrast .form-group select, .high-contrast .form-group textarea,
        .high-contrast .event-item {
            background-color: #333 !important;
            color: #fff !important;
            border-color: #666 !important;
        }
        .high-contrast .sidebar h2, .high-contrast .section-title, .high-contrast .card h3,
        .high-contrast .message-item strong, .high-contrast .announcement-item h4,
        .high-contrast .resource-item h4, .high-contrast .assignment-item h4,
        .high-contrast .event-item h4 {
            color: #ffd600 !important;
        }
        .high-contrast .sidebar ul li a, .high-contrast .btn-primary, .high-contrast .btn-primary:hover,
        .high-contrast .assignment-item .actions button {
            background-color: #ffd600 !important;
            color: #000 !important;
        }
        .high-contrast .sidebar ul li a:hover, .high-contrast .sidebar ul li a.active {
            background-color: #ffe066 !important;
            color: #000 !important;
        }
        .high-contrast .card p {
            color: #fff !important;
        }
        .high-contrast .document-list li a, .high-contrast .resource-item a {
            color: #ffd600 !important;
        }
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #fff;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        }
        .modal-content h2 {
            margin-top: 0;
            color: #176a3a;
        }
        .modal-content .close {
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #aaa;
        }
        .modal-content .close:hover {
            color: #000;
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <h2>Student Portal</h2>
        <ul>
            <li><a href="#dashboard" class="active">Dashboard</a></li>
            <li><a href="#my-subjects">My Subjects</a></li>
            <li><a href="#my-teachers">My Teachers</a></li>
            <li><a href="#grades-progress">Grades & Progress</a></li>
            <li><a href="#announcements-events">Announcements & Events</a></li>
            <li><a href="#messages">Messages</a></li>
            <li><a href="#profile-settings">Profile & Settings</a></li>
            <li><a href="#" id="mainPortalBtn">Main Portal</a></li> <!-- Added button -->
            <li><a href="#" id="logoutBtn">Logout</a></li>
        </ul>
    </div>

    <div class="main-content">
        <!-- Dashboard Section -->
        <section id="dashboard">
            <h1 class="section-title">Dashboard</h1>
            <p id="welcomeMessage">Welcome, Student Name!</p>
            <div class="card-container">
                <div class="card">
                    <h3>Current Grade Level</h3>
                    <p id="currentGradeLevel">G10</p>
                </div>
                <div class="card">
                    <h3>Unread Messages</h3>
                    <p id="unreadMessagesCount">0</p>
                </div>
            </div>
            <h2>Quick Overview</h2>
            <div id="dashboardOverview">
                <p>No recent updates.</p>
            </div>
        </section>

        <!-- My Subjects Section -->
        <section id="my-subjects" style="display:none;">
            <h1 class="section-title">My Subjects</h1>
            <div id="subjectsList">
                <!-- Subjects will be loaded here -->
            </div>
        </section>

        <!-- My Teachers Section -->
        <section id="my-teachers" style="display:none;">
            <h1 class="section-title">My Teachers</h1>
            <div id="teachersList">
                <!-- Teachers will be loaded here -->
            </div>
        </section>

        <!-- Grades & Academic Progress Section -->
        <section id="grades-progress" style="display:none;">
            <h1 class="section-title">Grades & Academic Progress</h1>
            <div class="form-group">
                <label for="selectSubjectGrades">Select Subject:</label>
                <select id="selectSubjectGrades">
                    <option value="">-- Select Subject --</option>
                    <!-- Subjects will be loaded dynamically -->
                </select>
            </div>
            <button class="btn-primary" id="loadGradesBtn">Load Grades</button>

            <h2 style="margin-top: 30px;">Grades Overview</h2>
            <table id="gradesTable">
                <thead>
                    <tr>
                        <th>Assignment/Exam</th>
                        <th>Grade</th>
                        <th>Weight</th>
                        <th>Comments</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Grades will be loaded here -->
                </tbody>
            </table>

            <h2 style="margin-top: 30px;">Attendance Record</h2>
            <table id="attendanceTable">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Status</th>
                        <th>Remarks</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Attendance will be loaded here -->
                </tbody>
            </table>
        </section>

        <!-- Assignments Section -->
        <section id="assignments" style="display:none;">
            <h1 class="section-title">Assignments</h1>
            <div id="assignmentsList">
                <!-- Assignments will be loaded here -->
            </div>
        </section>

        <!-- Announcements & Events Section -->
        <section id="announcements-events" style="display:none;">
            <h1 class="section-title">Announcements & Events</h1>
            <h2>School Announcements</h2>
            <div id="schoolAnnouncements">
                <!-- Announcements will be loaded here -->
            </div>
            <h2 style="margin-top: 30px;">Upcoming Events</h2>
            <div id="upcomingEvents">
                <!-- Events will be loaded here -->
            </div>
        </section>

        <!-- Messages Section -->
        <section id="messages" style="display:none;">
            <h1 class="section-title">Messages</h1>
            <div class="form-group">
                <label for="messageRecipient">Send Message To:</label>
                <select id="messageRecipient">
                    <option value="">-- Select Recipient --</option>
                    <option value="teacher1">Mr. John Doe (Math)</option>
                    <option value="teacher2">Ms. Jane Smith (Science)</option>
                    <option value="admin">School Administration</option>
                </select>
            </div>
            <div class="form-group">
                <label for="messageSubject">Subject:</label>
                <input type="text" id="messageSubject">
            </div>
            <div class="form-group">
                <label for="messageContent">Message:</label>
                <textarea id="messageContent"></textarea>
            </div>
            <button class="btn-primary" id="sendMessageBtn">Send Message</button>

            <h2 style="margin-top: 30px;">Inbox</h2>
            <div id="inboxMessages">
                <!-- Messages will be loaded here -->
            </div>
        </section>

        <!-- Profile & Settings Section -->
        <section id="profile-settings" style="display:none;">
            <h1 class="section-title">Profile & Settings</h1>
            <div class="form-group">
                <label for="studentName">Your Name:</label>
                <input type="text" id="studentName" value="Juan Dela Cruz" readonly>
            </div>
            <div class="form-group">
                <label for="studentId">Student ID:</label>
                <input type="text" id="studentId" value="S001" readonly>
            </div>
            <div class="form-group">
                <label for="studentEmail">Email:</label>
                <input type="email" id="studentEmail" value="juan.dela.cruz@example.com">
            </div>
            <div class="form-group">
                <label for="studentGradeLevel">Grade Level:</label>
                <input type="text" id="studentGradeLevel" value="G10" readonly>
            </div>
            <button class="btn-primary">Save Changes</button>

            <h2 style="margin-top: 30px;">Change Password</h2>
            <div class="form-group">
                <label for="currentPassword">Current Password:</label>
                <input type="password" id="currentPassword">
            </div>
            <div class="form-group">
                <label for="newPassword">New Password:</label>
                <input type="password" id="newPassword">
            </div>
            <div class="form-group">
                <label for="confirmNewPassword">Confirm New Password:</label>
                <input type="password" id="confirmNewPassword">
            </div>
            <button class="btn-primary">Change Password</button>

            <h2 style="margin-top: 30px;">Accessibility</h2>
            <div class="form-group">
                <label for="highContrastToggle">High Contrast Mode:</label>
                <input type="checkbox" id="highContrastToggle">
            </div>
        </section>
    </div>

    <!-- Teacher Profile Modal -->
    <div id="teacherModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2 id="teacherName">Teacher Name</h2>
            <p><strong>Email:</strong> <span id="teacherEmail"></span></p>
            <p><strong>Phone:</strong> <span id="teacherPhone"></span></p>
            <p><strong>Subjects:</strong> <span id="teacherSubjects"></span></p>
            <p><strong>Qualifications:</strong> <span id="teacherQualifications"></span></p>
            <p><strong>Years of Experience:</strong> <span id="teacherYearsOfExperience"></span></p>
            <p><strong>Bio:</strong> <span id="teacherBio"></span></p>
        </div>
    </div>

    <script>
        // Simulated Data (replace with actual backend data in a real application)
        let currentStudent = {
            id: 'S001',
            firstName: 'Juan',
            lastName: 'Dela Cruz',
            email: 'juan.dela.cruz@example.com',
            gradeLevel: 'G10',
            subjects: [ // Changed from courses to subjects
                { id: 'SUB001', name: 'Mathematics 10', teacher: 'Mr. John Doe' },
                { id: 'SUB002', name: 'Science 10', teacher: 'Ms. Jane Smith' },
                { id: 'SUB003', name: 'English 10', teacher: 'Ms. Emily White' }
            ],
            grades: {
                'SUB001': [ // Mathematics 10
                    { assignment: 'Algebra Quiz', grade: 92, weight: 20, comments: 'Good understanding of concepts.' },
                    { assignment: 'Geometry Exam', grade: 88, weight: 30, comments: 'Needs improvement in proofs.' },
                    { assignment: 'Final Project', grade: 95, weight: 50, comments: 'Excellent work!' }
                ],
                'SUB002': [ // Science 10
                    { assignment: 'Biology Lab Report', grade: 85, weight: 25, comments: 'Detailed observations.' },
                    { assignment: 'Chemistry Midterm', grade: 90, weight: 40, comments: 'Strong grasp of chemical reactions.' }
                ]
            },
            attendance: [
                { date: '2024-04-01', status: 'Present', remarks: '' },
                { date: '2024-04-02', status: 'Present', remarks: '' },
                { date: '2024-04-03', status: 'Absent', remarks: 'Sick leave' },
                { date: '2024-04-04', status: 'Present', remarks: '' },
                { date: '2024-04-05', status: 'Late', remarks: 'Traffic' }
            ],

            messages: [
                { id: 'M001', from: 'Mr. John Doe', subject: 'Math Class Update', content: 'Reminder: The upcoming quiz will cover chapters 5 and 6.', date: '2024-04-25', read: false },
                { id: 'M002', from: 'School Administration', subject: 'School Event: Sports Fest', content: 'Please be informed that May 1st will be a school holiday.', date: '2024-04-20', read: true }
            ],
            announcements: [ // These would typically be school-wide, not student-specific
                { id: 'AN001', title: 'Parent-Teacher Conference Schedule', content: 'The schedule for the upcoming parent-teacher conferences is now available. Please check the school calendar for details.', date: 'April 22, 2024', read: false },
                { id: 'AN002', title: 'School Sports Fest 2024', content: 'Get ready for our annual Sports Fest! Details about events and participation will be announced soon.', date: 'April 18, 2024', read: true }
            ],
            events: [ // New events data
                { id: 'EV001', title: 'School Fair', date: '2024-05-20', time: '9:00 AM - 4:00 PM', location: 'School Grounds', description: 'Annual school fair with games, food, and performances.' },
                { id: 'EV002', title: 'Graduation Ceremony', date: '2024-06-05', time: '2:00 PM', location: 'School Auditorium', description: 'Ceremony for graduating students.' }
            ]
        };

        // Simulated Teachers Data
        let teachers = [
            {
                name: 'Mr. John Doe',
                email: 'john.doe@school.edu',
                phone: '+1-234-567-8901',
                subjects: ['Mathematics 10'],
                bio: 'A dedicated mathematics educator with over 15 years of experience in fostering analytical thinking and problem-solving skills among students. Holds a Master\'s degree in Mathematics and is committed to creating an engaging learning environment that promotes academic excellence.',
                qualifications: 'M.Sc. in Mathematics, B.Ed. in Secondary Education, Certified Math Instructor',
                yearsOfExperience: 15,
                photo: 'https://via.placeholder.com/100x100/176a3a/ffffff?text=JD'
            },
            {
                name: 'Ms. Jane Smith',
                email: 'jane.smith@school.edu',
                phone: '+1-234-567-8902',
                subjects: ['Science 10'],
                bio: 'An accomplished science educator with a strong background in biological and chemical sciences. Specializes in hands-on laboratory instruction and inquiry-based learning to develop students\' scientific literacy and research capabilities.',
                qualifications: 'M.Sc. in Biology, B.Sc. in Chemistry, Teaching Certification in Science Education',
                yearsOfExperience: 12,
                photo: 'https://via.placeholder.com/100x100/176a3a/ffffff?text=JS'
            },
            {
                name: 'Ms. Emily White',
                email: 'emily.white@school.edu',
                phone: '+1-234-567-8903',
                subjects: ['English 10'],
                bio: 'A passionate English literature instructor dedicated to cultivating critical thinking, effective communication, and literary appreciation. Employs innovative teaching methods to enhance students\' reading comprehension and writing proficiency.',
                qualifications: 'M.A. in English Literature, B.A. in Education, Certified English Language Arts Teacher',
                yearsOfExperience: 10,
                photo: 'https://via.placeholder.com/100x100/176a3a/ffffff?text=EW'
            }
        ];

        // Utility Functions
        function showSection(sectionId) {
            document.querySelectorAll('.main-content section').forEach(section => {
                section.style.display = 'none';
            });
            document.getElementById(sectionId).style.display = 'block';

            document.querySelectorAll('.sidebar ul li a').forEach(link => {
                link.classList.remove('active');
            });
            document.querySelector(`.sidebar ul li a[href="#${sectionId}"]`).classList.add('active');
        }

        function populateTable(tableId, data, rowCreator) {
            const tableBody = document.querySelector(`#${tableId} tbody`);
            tableBody.innerHTML = '';
            if (data.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="${document.querySelector(`#${tableId} thead tr`).children.length}" style="text-align: center;">No data available.</td></tr>`;
                return;
            }
            data.forEach(item => {
                const row = rowCreator(item);
                tableBody.appendChild(row);
            });
        }

        // Dashboard Functions
        function updateDashboard() {
            document.getElementById('welcomeMessage').textContent = `Welcome, ${currentStudent.firstName} ${currentStudent.lastName}!`;
            document.getElementById('currentGradeLevel').textContent = currentStudent.gradeLevel;

            const unreadMessages = currentStudent.messages.filter(m => !m.read);
            document.getElementById('unreadMessagesCount').textContent = unreadMessages.length;

            const overviewDiv = document.getElementById('dashboardOverview');
            overviewDiv.innerHTML = '';
            const recentUpdates = [];

            if (unreadMessages.length > 0) {
                recentUpdates.push(`You have ${unreadMessages.length} unread message(s).`);
            }
            if (currentStudent.announcements.filter(a => !a.read).length > 0) {
                recentUpdates.push(`You have ${currentStudent.announcements.filter(a => !a.read).length} unread announcement(s).`);
            }
            if (currentStudent.events.length > 0) {
                recentUpdates.push(`There are ${currentStudent.events.length} upcoming event(s).`);
            }


            if (recentUpdates.length > 0) {
                recentUpdates.forEach(update => {
                    const p = document.createElement('p');
                    p.textContent = `- ${update}`;
                    overviewDiv.appendChild(p);
                });
            } else {
                overviewDiv.innerHTML = '<p>No recent updates.</p>';
            }
        }

        // My Subjects Section
        function renderSubjects() {
            const subjectsListDiv = document.getElementById('subjectsList');
            subjectsListDiv.innerHTML = '';
            if (currentStudent.subjects.length === 0) {
                subjectsListDiv.innerHTML = '<p>You are not currently enrolled in any subjects.</p>';
                return;
            }
            currentStudent.subjects.forEach(subject => {
                const subjectCard = document.createElement('div');
                subjectCard.classList.add('card');
                subjectCard.innerHTML = `
                    <h3>${subject.name}</h3>
                    <p>Teacher: ${subject.teacher}</p>
                    <button class="btn-primary" onclick="selectSubjectForDetails('${subject.id}')">View Details</button>
                `;
                subjectsListDiv.appendChild(subjectCard);
            });
        }

        // My Teachers Section
        function renderTeachers() {
            const teachersListDiv = document.getElementById('teachersList');
            teachersListDiv.innerHTML = '';
            const teacherNames = [...new Set(currentStudent.subjects.map(subject => subject.teacher))];
            if (teacherNames.length === 0) {
                teachersListDiv.innerHTML = '<p>No teachers assigned.</p>';
                return;
            }
            teacherNames.forEach(teacherName => {
                const teacher = teachers.find(t => t.name === teacherName);
                if (teacher) {
                    const teacherCard = document.createElement('div');
                    teacherCard.classList.add('card');
                    teacherCard.innerHTML = `
                        <img src="${teacher.photo}" alt="${teacher.name}" style="width: 100px; height: 100px; border-radius: 50%; margin-bottom: 10px;">
                        <h3>${teacher.name}</h3>
                        <p>Subjects: ${teacher.subjects.join(', ')}</p>
                        <button class="btn-primary" onclick="openTeacherModal('${teacher.name}')">View Profile</button>
                    `;
                    teachersListDiv.appendChild(teacherCard);
                }
            });
        }

        function openTeacherModal(teacherName) {
            const teacher = teachers.find(t => t.name === teacherName);
            if (teacher) {
                document.getElementById('teacherName').textContent = teacher.name;
                document.getElementById('teacherEmail').textContent = teacher.email;
                document.getElementById('teacherPhone').textContent = teacher.phone;
                document.getElementById('teacherSubjects').textContent = teacher.subjects.join(', ');
                document.getElementById('teacherQualifications').textContent = teacher.qualifications;
                document.getElementById('teacherYearsOfExperience').textContent = teacher.yearsOfExperience;
                document.getElementById('teacherBio').textContent = teacher.bio;
                document.getElementById('teacherModal').style.display = 'flex';
            }
        }

        function closeModal() {
            document.getElementById('teacherModal').style.display = 'none';
        }

        function selectSubjectForDetails(subjectId) {
            const subject = currentStudent.subjects.find(c => c.id === subjectId);
            if (subject) {
                const selectSubjectGrades = document.getElementById('selectSubjectGrades');
                selectSubjectGrades.value = subjectId;
                loadGradesAndAttendance();
                showSection('grades-progress');
            }
        }

        // Grades & Academic Progress Section
        function populateSubjectSelectForGrades() {
            const selectSubjectGrades = document.getElementById('selectSubjectGrades');
            selectSubjectGrades.innerHTML = '<option value="">-- Select Subject --</option>';
            currentStudent.subjects.forEach(subject => {
                const option = document.createElement('option');
                option.value = subject.id;
                option.textContent = subject.name;
                selectSubjectGrades.appendChild(option);
            });
        }

        function loadGradesAndAttendance() {
            const selectedSubjectId = document.getElementById('selectSubjectGrades').value;
            const subjectGrades = currentStudent.grades[selectedSubjectId] || [];

            // Render Grades
            populateTable('gradesTable', subjectGrades, item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.assignment}</td>
                    <td>${item.grade}</td>
                    <td>${item.weight}%</td>
                    <td>${item.comments}</td>
                `;
                return row;
            });

            // Render Attendance (assuming attendance is general, not subject-specific for simplicity)
            populateTable('attendanceTable', currentStudent.attendance, record => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${record.date}</td>
                    <td>${record.status}</td>
                    <td>${record.remarks}</td>
                `;
                return row;
            });
        }

        // Assignments Section
        function renderAssignments() {
        }

        function markAssignmentComplete(assignmentId) {
        }

        // Announcements & Events Section
        function renderAnnouncementsAndEvents() {
            const schoolAnnouncementsDiv = document.getElementById('schoolAnnouncements');
            schoolAnnouncementsDiv.innerHTML = '';
            if (currentStudent.announcements.length === 0) {
                schoolAnnouncementsDiv.innerHTML = '<p>No announcements available.</p>';
            } else {
                currentStudent.announcements.sort((a, b) => new Date(b.date) - new Date(a.date)); // Sort by date descending
                currentStudent.announcements.forEach(ann => {
                    const announcementItem = document.createElement('div');
                    announcementItem.classList.add('announcement-item');
                    if (!ann.read) {
                        announcementItem.style.fontWeight = 'bold'; // Highlight unread
                    }
                    announcementItem.innerHTML = `
                        <h4>${ann.title}</h4>
                        <p>${ann.content}</p>
                        <small>Posted on ${ann.date} ${!ann.read ? '(Unread)' : ''}</small>
                    `;
                    announcementItem.addEventListener('click', () => {
                        ann.read = true; // Mark as read on click
                        renderAnnouncementsAndEvents(); // Re-render to update status
                        updateDashboard(); // Update unread count on dashboard
                    });
                    schoolAnnouncementsDiv.appendChild(announcementItem);
                });
            }

            const upcomingEventsDiv = document.getElementById('upcomingEvents');
            upcomingEventsDiv.innerHTML = '';
            if (currentStudent.events.length === 0) {
                upcomingEventsDiv.innerHTML = '<p>No upcoming events.</p>';
            } else {
                currentStudent.events.sort((a, b) => new Date(a.date) - new Date(b.date)); // Sort by date ascending
                currentStudent.events.forEach(event => {
                    const eventItem = document.createElement('div');
                    eventItem.classList.add('event-item');
                    eventItem.innerHTML = `
                        <h4>${event.title}</h4>
                        <p><strong>Date:</strong> ${event.date}</p>
                        <p><strong>Time:</strong> ${event.time}</p>
                        <p><strong>Location:</strong> ${event.location}</p>
                        <p>${event.description}</p>
                    `;
                    upcomingEventsDiv.appendChild(eventItem);
                });
            }
        }

        // Messages Section
        function renderMessages() {
            const inboxMessagesDiv = document.getElementById('inboxMessages');
            inboxMessagesDiv.innerHTML = '';
            if (currentStudent.messages.length === 0) {
                inboxMessagesDiv.innerHTML = '<p>Your inbox is empty.</p>';
                return;
            }
            currentStudent.messages.sort((a, b) => new Date(b.date) - new Date(a.date)); // Sort by date descending
            currentStudent.messages.forEach(msg => {
                const messageItem = document.createElement('div');
                messageItem.classList.add('message-item');
                if (!msg.read) {
                    messageItem.style.fontWeight = 'bold'; // Highlight unread messages
                }
                messageItem.innerHTML = `
                    <strong>From: ${msg.from}</strong><br>
                    <strong>Subject: ${msg.subject}</strong>
                    <p>${msg.content}</p>
                    <small>${msg.date} ${!msg.read ? '(Unread)' : ''}</small>
                `;
                messageItem.addEventListener('click', () => {
                    msg.read = true; // Mark as read on click
                    renderMessages(); // Re-render to update status
                    updateDashboard(); // Update unread count on dashboard
                });
                inboxMessagesDiv.appendChild(messageItem);
            });
        }

        function sendMessage() {
            const recipient = document.getElementById('messageRecipient').value;
            const subject = document.getElementById('messageSubject').value.trim();
            const content = document.getElementById('messageContent').value.trim();

            if (!recipient || !subject || !content) {
                alert('Please fill in all message fields.');
                return;
            }

            // Simulate sending message (in a real app, this sends to backend)
            alert(`Message sent to ${recipient} with subject "${subject}".`);
            document.getElementById('messageRecipient').value = '';
            document.getElementById('messageSubject').value = '';
            document.getElementById('messageContent').value = '';
        }

        // Profile & Settings Section
        function loadProfileSettings() {
            document.getElementById('studentName').value = `${currentStudent.firstName} ${currentStudent.lastName}`;
            document.getElementById('studentId').value = currentStudent.id;
            document.getElementById('studentEmail').value = currentStudent.email;
            document.getElementById('studentGradeLevel').value = currentStudent.gradeLevel;

            // Load accessibility setting
            const highContrastEnabled = localStorage.getItem('highContrastMode') === 'true';
            document.getElementById('highContrastToggle').checked = highContrastEnabled;
            if (highContrastEnabled) {
                document.body.classList.add('high-contrast');
            } else {
                document.body.classList.remove('high-contrast');
            }
        }

        function saveProfileChanges() {
            // In a real app, save changes to backend
            currentStudent.email = document.getElementById('studentEmail').value;
            alert('Profile changes saved!');
        }

        function changePassword() {
            const currentPass = document.getElementById('currentPassword').value;
            const newPass = document.getElementById('newPassword').value;
            const confirmNewPass = document.getElementById('confirmNewPassword').value;

            if (currentPass === '' || newPass === '' || confirmNewPass === '') {
                alert('Please fill in all password fields.');
                return;
            }
            if (newPass !== confirmNewPass) {
                alert('New password and confirmation do not match.');
                return;
            }
            if (currentPass === newPass) {
                alert('New password cannot be the same as the current password.');
                return;
            }
            // Simulate password change (in a real app, validate current password with backend)
            alert('Password changed successfully!');
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmNewPassword').value = '';
        }

        function toggleHighContrast() {
            document.body.classList.toggle('high-contrast');
            const isHighContrast = document.body.classList.contains('high-contrast');
            localStorage.setItem('highContrastMode', isHighContrast);
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Sidebar Navigation
            document.querySelectorAll('.sidebar ul li a').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const sectionId = this.getAttribute('href').substring(1);
                    showSection(sectionId);
                });
            });

            // Initial Load
            showSection('dashboard');
            updateDashboard();
            renderSubjects(); // Changed from renderCourses
            renderTeachers(); // Render teachers list
            populateSubjectSelectForGrades(); // Changed from populateCourseSelectForGrades
            // renderAssignments(); // Removed assignments rendering
            renderAnnouncementsAndEvents(); // New function for combined section
            renderMessages();
            loadProfileSettings(); // Load profile settings on initial page load

            // Grades & Academic Progress Events
            document.getElementById('loadGradesBtn').addEventListener('click', loadGradesAndAttendance);

            // Messages Events
            document.getElementById('sendMessageBtn').addEventListener('click', sendMessage);

            // Profile & Settings Events
            document.querySelector('#profile-settings .btn-primary:nth-of-type(1)').addEventListener('click', saveProfileChanges);
            document.querySelector('#profile-settings .btn-primary:nth-of-type(2)').addEventListener('click', changePassword);
            document.getElementById('highContrastToggle').addEventListener('change', toggleHighContrast);

            // Main Portal Button
            document.getElementById('mainPortalBtn').addEventListener('click', function(e) {
                e.preventDefault();
                window.location.href = 'main.html'; // Redirect to the main portal page
            });

            // Logout Button
            document.getElementById('logoutBtn').addEventListener('click', function(e) {
                e.preventDefault();
                if (confirm('Are you sure you want to log out?')) {
                    window.location.href = 'main.html'; // Redirect to main page
                }
            });
        });
    </script>
</body>
</html>
