<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Admissions - Aliaga National High School</title>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/fonts/remixicon.css" rel="stylesheet" />
    <link rel="stylesheet" href="darkmode.css">
    <link rel="stylesheet" href="responsive.css">
    <script src="darkmode.js"></script>
    <style>
        /* Layout */
        main { max-width:1100px; margin:24px auto; padding:0 16px; }
        main h2 { color:#1a6633; }
        .admission-section { background:#fff; padding:18px; border-radius:8px; margin-bottom:18px; box-shadow:0 4px 18px rgba(0,0,0,0.03); }
        .admission-section h3 { margin-top:0; color:#13522d; }
        .admission-section ul { margin:8px 0 0 18px; }

        /* Auth modal */
        .auth-modal { position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:9999; }
        .auth-backdrop { position:absolute; inset:0; background:rgba(0,0,0,0.45); }
        .auth-content { position:relative; background:#fff; border-radius:12px; max-width:420px; width:92%; padding:22px; box-shadow:0 8px 30px rgba(20,60,30,0.12); z-index:2; }
        .auth-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:14px; }
        .auth-header h3 { margin:0; color:#1a6633; }
        .auth-close { background:transparent; border:none; font-size:1.1rem; cursor:pointer; color:#7a7a7a; }
        .auth-forms form { display:none; gap:12px; }
        .auth-forms form.active { display:block; }
        .auth-row { margin-bottom:10px; }
        .auth-row input, .auth-row select { width:100%; padding:10px 12px; border:1px solid #d6e3d0; border-radius:8px; box-sizing:border-box; color:#13522d; }
        .auth-actions { display:flex; gap:8px; margin-top:12px; }
        .btn-primary { background:#1a6633; color:#fff; border:none; padding:10px 14px; border-radius:8px; cursor:pointer; font-weight:600; }
        .btn-secondary { background:#e0b34d; color:#13522d; border:none; padding:10px 14px; border-radius:8px; cursor:pointer; font-weight:600; }


    </style>
</head>
<body>
    <div id="header-placeholder"></div>

    <main>
        <h2>Admissions</h2>

        <section class="admission-section">
            <h3>Enrollment Requirements</h3>
            <ul>
                <li>Completed application form</li>
                <li>Latest report card or transcript of records</li>
                <li>Birth certificate (authenticated copy)</li>
                <li>2x2 ID photos</li>
                <li>Other documents as required by the registrar</li>
            </ul>
        </section>

        <section class="admission-section">
            <h3>Enrollment Process</h3>
            <p>Visit our campus or apply online. Our admissions staff will assist you with document verification, orientation, and section assignment.</p>
        </section>

        <section class="admission-section">
            <h3>Important Dates</h3>
            <ul>
                <li>Enrollment period: April 1 - May 31</li>
                <li>Orientation: June 10</li>
                <li>Classes start: June 15</li>
            </ul>
        </section>
    </main>

    <div id="footer-placeholder"></div>

     <!-- Authentication modal added so the nav Login/Register works on this page -->
    <div id="authModal" class="auth-modal" aria-hidden="true">
        <div class="auth-backdrop" id="authBackdrop"></div>
        <div class="auth-content" role="dialog" aria-modal="true" aria-labelledby="authTitle">
            <div class="auth-header">
                <h3 id="authTitle">Login</h3>
                <button class="auth-close" id="authCloseBtn" aria-label="Close">&times;</button>
            </div>

            <div class="auth-forms">
                <form id="loginForm" class="active" autocomplete="off">
                    <div class="auth-row">
                        <label class="sr-only">User type</label>
                        <select id="userType" required>
                            <option value="">Select role</option>
                            <option value="student">Student</option>
                            <option value="teacher">Teacher</option>
                            <option value="parent">Parent</option>
                            <option value="admin">Admin</option>
                        </select>
                    </div>
                    <div class="auth-row">
                        <input id="loginEmail" type="email" placeholder="Email" required>
                    </div>
                    <div class="auth-row">
                        <input id="loginPassword" type="password" placeholder="Password" required>
                    </div>
                        <div class="auth-row" style="display:flex;gap:8px;align-items:center;">
                            <button type="button" id="sendCodeBtn" class="btn-primary" style="flex:1;background:#0b5;">Send login code to email</button>
                        </div>
                        <div id="codeVerifyArea" style="display:none;">
                            <div class="auth-row">
                                <input id="loginCode" type="text" placeholder="One-time code (123456)" pattern="\\d{6}">
                            </div>
                            <div class="auth-row">
                                <input id="loginPasswordVerify" type="password" placeholder="Password (for this account)">
                            </div>
                            <div class="auth-actions">
                                <button type="button" id="verifyCodeBtn" class="btn-primary">Verify code & login</button>
                            </div>
                            <div id="codePreview" style="font-size:0.9rem;color:#666;display:none;margin-top:8px;"></div>
                        </div>
                    <div class="auth-actions">
                        <button type="submit" class="btn-primary">Login</button>
                        <button type="button" id="showRegister" class="btn-secondary">Register</button>
                    </div>
                </form>

                <form id="registerForm" autocomplete="off">
                    <div class="auth-row">
                        <input id="registerFirstName" type="text" placeholder="First name" required>
                    </div>
                    <div class="auth-row">
                        <input id="registerLastName" type="text" placeholder="Last name" required>
                    </div>
                    <div class="auth-row">
                        <input id="registerEmail" type="email" placeholder="Email" required>
                    </div>
                    <div class="auth-row">
                        <input id="registerPassword" type="password" placeholder="Password" required>
                    </div>
                    <div class="auth-row" style="display:flex;gap:8px;align-items:center;">
                        <button type="button" id="sendRegCodeBtn" class="btn-primary" style="flex:1;background:#0b5;">Send registration code to email</button>
                    </div>
                    <div id="regCodeArea" style="display:none;">
                        <div class="auth-row">
                            <input id="regCode" type="text" placeholder="One-time code (123456)" pattern="\\d{6}">
                        </div>
                        <div class="auth-row">
                            <input id="regPasswordVerify" type="password" placeholder="Confirm password">
                        </div>
                        <div class="auth-actions">
                            <button type="button" id="verifyRegBtn" class="btn-primary">Verify code & complete registration</button>
                        </div>
                        <div id="regCodePreview" style="font-size:0.9rem;color:#666;display:none;margin-top:8px;"></div>
                    </div>
                    <div class="auth-row">
                        <select id="registerGradeLevel" required>
                            <option value="">Select grade level</option>
                            <option value="G7">Grade 7</option>
                            <option value="G8">Grade 8</option>
                            <option value="G9">Grade 9</option>
                            <option value="G10">Grade 10</option>
                            <option value="G11">Grade 11</option>
                            <option value="G12">Grade 12</option>
                        </select>
                    </div>
                    <div class="auth-actions">
                        <button type="submit" class="btn-primary">Register</button>
                        <button type="button" id="showLogin" class="btn-secondary">Back to Login</button>
                    </div>
                </form>
            </div>

            <div class="auth-switch">
                By logging in you accept school policies.
            </div>
        </div>
    </div>

    <script>
        (function(){
            // Elements
            const loginBtn = document.getElementById('loginRegisterBtn');
            const authModal = document.getElementById('authModal');
            const authBackdrop = document.getElementById('authBackdrop');
            const authCloseBtn = document.getElementById('authCloseBtn');
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            const showRegister = document.getElementById('showRegister');
            const showLogin = document.getElementById('showLogin');

            // Simulated users (replace with backend)
            const users = {
                student: [{ email: 'student@example.com', password: 'password' }],
                teacher: [{ email: 'teacher@example.com', password: 'password' }],
                parent: [{ email: 'parent@example.com', password: 'password' }],
                admin: [{ email: 'admin@example.com', password: 'password' }]
            };

            function openModal(mode = 'login'){
                authModal.style.display = 'flex';
                authModal.setAttribute('aria-hidden','false');
                document.getElementById('authTitle').textContent = (mode === 'login') ? 'Login' : 'Student Registration';
                if(mode === 'login'){
                    loginForm.classList.add('active');
                    registerForm.classList.remove('active');
                } else {
                    registerForm.classList.add('active');
                    loginForm.classList.remove('active');
                }
            }

            // Send-code and verify handlers (calls backend endpoints)
            const sendCodeBtn = document.getElementById('sendCodeBtn');
            const codeVerifyArea = document.getElementById('codeVerifyArea');
            const verifyCodeBtn = document.getElementById('verifyCodeBtn');
            const codePreview = document.getElementById('codePreview');

            if(sendCodeBtn){
                sendCodeBtn.addEventListener('click', async function(){
                    const email = (document.getElementById('loginEmail')||{}).value?.trim()||'';
                    if(!email){ alert('Enter an email to send code to.'); return; }
                    sendCodeBtn.disabled = true; sendCodeBtn.textContent = 'Sending...';
                    try{
                        const resp = await fetch('/api/auth/google/request-code', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({ email }) });
                        const data = await resp.json();
                        if(!resp.ok) throw new Error(data.message||'Failed to send code');
                        codeVerifyArea.style.display = 'block';
                        if(data.preview){ codePreview.innerHTML = 'Preview email: <a href="'+data.preview+'" target="_blank">open</a>'; codePreview.style.display='block'; }
                    }catch(err){ alert(err.message||'Failed to send code'); }
                    finally{ sendCodeBtn.disabled = false; sendCodeBtn.textContent = 'Send login code to email'; }
                });
            }

            if(verifyCodeBtn){
                verifyCodeBtn.addEventListener('click', async function(){
                    const email = (document.getElementById('loginEmail')||{}).value?.trim()||'';
                    const code = (document.getElementById('loginCode')||{}).value||'';
                    const password = (document.getElementById('loginPasswordVerify')||{}).value||'';
                    if(!email || !code || !password){ alert('Provide email, code and password to verify.'); return; }
                    verifyCodeBtn.disabled = true; verifyCodeBtn.textContent = 'Verifying...';
                    try{
                        const resp = await fetch('/api/auth/google/verify', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ email, code, password, purpose: 'login' }) });
                        const data = await resp.json();
                        if(!resp.ok) throw new Error(data.message||'Verification failed');
                        if(data.token) localStorage.setItem('token', data.token);
                        const userRole = data.user?.role || (document.getElementById('userType')||{}).value||'student';
                        const dest = { student:'Students.html', teacher:'Teachers Portal.html', parent:'parents.html', admin:'admin.html' }[userRole]||'main.html';
                        alert('Login successful'); closeModal(); setTimeout(()=> window.location.href = dest, 300);
                    }catch(err){ alert(err.message||'Verification failed'); }
                    finally{ verifyCodeBtn.disabled = false; verifyCodeBtn.textContent = 'Verify code & login'; }
                });
            }

            const sendRegCodeBtn = document.getElementById('sendRegCodeBtn');
            const regCodeArea = document.getElementById('regCodeArea');
            const verifyRegBtn = document.getElementById('verifyRegBtn');
            const regCodePreview = document.getElementById('regCodePreview');

            if(sendRegCodeBtn){
                sendRegCodeBtn.addEventListener('click', async function(){
                    const email = (document.getElementById('registerEmail')||{}).value?.trim()||'';
                    if(!email){ alert('Enter an email to send code to.'); return; }
                    sendRegCodeBtn.disabled = true; sendRegCodeBtn.textContent = 'Sending...';
                    try{
                        const resp = await fetch('/api/auth/google/request-code', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({ email }) });
                        const data = await resp.json();
                        if(!resp.ok) throw new Error(data.message||'Failed to send code');
                        regCodeArea.style.display = 'block';
                        if(data.preview){ regCodePreview.innerHTML = 'Preview email: <a href="'+data.preview+'" target="_blank">open</a>'; regCodePreview.style.display='block'; }
                    }catch(err){ alert(err.message||'Failed to send code'); }
                    finally{ sendRegCodeBtn.disabled = false; sendRegCodeBtn.textContent = 'Send registration code to email'; }
                });
            }

            if(verifyRegBtn){
                verifyRegBtn.addEventListener('click', async function(){
                    const email = (document.getElementById('registerEmail')||{}).value?.trim()||'';
                    const code = (document.getElementById('regCode')||{}).value||'';
                    const password = (document.getElementById('regPasswordVerify')||{}).value||'';
                    if(!email || !code || !password){ alert('Provide email, code and password to verify.'); return; }
                    verifyRegBtn.disabled = true; verifyRegBtn.textContent = 'Verifying...';
                    try{
                        const resp = await fetch('/api/auth/google/verify', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ email, code, password, purpose: 'register' }) });
                        const data = await resp.json();
                        if(!resp.ok) throw new Error(data.message||'Verification failed');
                        if(data.token) localStorage.setItem('token', data.token);
                        alert('Registration successful'); closeModal(); setTimeout(()=> window.location.href = 'main.html', 300);
                    }catch(err){ alert(err.message||'Verification failed'); }
                    finally{ verifyRegBtn.disabled = false; verifyRegBtn.textContent = 'Verify code & complete registration'; }
                });
            }
            function closeModal(){
                authModal.style.display = 'none';
                authModal.setAttribute('aria-hidden','true');
            }

            if(loginBtn){
                loginBtn.addEventListener('click', function(e){
                    e.preventDefault();
                    openModal('login');
                });
            }

            if(authBackdrop){
                authBackdrop.addEventListener('click', closeModal);
            }
            if(authCloseBtn){
                authCloseBtn.addEventListener('click', closeModal);
            }
            // switch to register
            if(showRegister){
                showRegister.addEventListener('click', function(e){
                    e.preventDefault();
                    openModal('register');
                });
            }
            if(showLogin){
                showLogin.addEventListener('click', function(e){
                    e.preventDefault();
                    openModal('login');
                });
            }

            // Login submit
            if(loginForm){
                loginForm.addEventListener('submit', function(e){
                    e.preventDefault();
                    const email = (document.getElementById('loginEmail')||{}).value?.trim()||'';
                    const password = (document.getElementById('loginPassword')||{}).value||'';
                    const userType = (document.getElementById('userType')||{}).value||'';

                    if(!userType){
                        alert('Please select a role.');
                        return;
                    }
                    if(!email || !password){
                        alert('Enter email and password.');
                        return;
                    }
                    const list = users[userType] || [];
                    const found = list.find(u => u.email === email && u.password === password);
                    if(found){
                        alert('Login successful. Redirecting...');
                        closeModal();
                        // redirect destinations (adjust filenames if needed)
                        const dest = {
                            student:'Students.html',
                            teacher:'Teachers Portal.html',
                            parent:'parents.html',
                            admin:'admin.html'
                        }[userType] || 'main.html';
                        setTimeout(()=> window.location.href = dest, 300);
                    } else {
                        alert('Invalid credentials. Try again.');
                    }
                });
            }

            // Register submit (adds to simulated students and stores in localStorage)
            if(registerForm){
                registerForm.addEventListener('submit', function(e){
                    e.preventDefault();
                    const firstName = (document.getElementById('registerFirstName')||{}).value?.trim()||'';
                    const lastName = (document.getElementById('registerLastName')||{}).value?.trim()||'';
                    const email = (document.getElementById('registerEmail')||{}).value?.trim()||'';
                    const password = (document.getElementById('registerPassword')||{}).value||'';
                    const gradeLevel = (document.getElementById('registerGradeLevel')||{}).value||'';

                    if(!firstName || !lastName || !email || !password || !gradeLevel){
                        alert('Please fill all registration fields.');
                        return;
                    }
                    // check existing
                    const exists = (users.student || []).some(u => u.email === email);
                    if(exists){
                        alert('Email already registered.');
                        return;
                    }
                    const newStudent = { firstName, lastName, email, password, gradeLevel };
                    users.student.push(newStudent);
                    localStorage.setItem('newEnrollmentSubmission', JSON.stringify(newStudent));
                    alert('Registration successful. Please login.');
                    openModal('login');
                });
            }

            // keyboard escape to close
            document.addEventListener('keydown', function(e){
                if(e.key === 'Escape' && authModal.style.display === 'flex') closeModal();
            });
        })();
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const loginRegisterBtn = document.getElementById('loginRegisterBtn');
            loginRegisterBtn.addEventListener('click', function (e) {
                e.preventDefault();
                alert('Login/Register modal functionality goes here.');
            });
        });
    </script>


</body>
</html>